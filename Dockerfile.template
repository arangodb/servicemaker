FROM {BASE_IMAGE}

USER root

COPY {PROJECT_DIR} /home/user/{PROJECT_DIR}
RUN chown -R user: {PROJECT_DIR}

USER user
WORKDIR /home/user/{PROJECT_DIR}
ENV UV_HTTP_TIMEOUT=3600
RUN env

RUN <<EOF
. /home/user/.local/bin/env
. /home/user/the_venv/bin/activate
uv sync --active
EOF

EXPOSE {PORT}

CMD ["/bin/bash", "-c", ". /home/user/.local/bin/env && . /home/user/the_venv/bin/activate && uv run {ENTRYPOINT}"]
